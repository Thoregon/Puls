<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Thore͛gon Dev Test</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">
    <style>
        body {
            font-family      : "Helvetica Neue", Arial, Helvetica, sans-serif;
            font-weight      : 200;
            background-color : white;
            margin           : 0;
            padding          : 0;
        }
    </style>
</head>
<body>

<p>Thore͛gon Dev Server Test</p>
<div id="display">

</div>

<script type="module" src="testclient.mjs"></script>
<script type="module">
    import TestClient from "./testclient.mjs";
    (async () => {
        let tc = await new TestClient()
            //.display('#display')
            .connect();

        let head = await tc.head('/test/test.txt');
        let e = document.createElement('span');
        e.innerText = JSON.stringify(head);
        document.getElementById('display').appendChild(e);
    })();

    (async () => {
        let tc = await new TestClient()
            //.display('#display')
            .connect();

        let stream = await tc.read('/test/test.txt');

        let reader = stream.getReader();
        let done = false;
        do {
            let res = await reader.read();
            if (res.value) {
                let e = document.createElement('span');
                e.innerText = res.value;
                document.getElementById('display').appendChild(e);
            }
            done = res.done;
        } while (!done);
    });

    (async () => {
        let tc = await new TestClient()
            //.display('#display')
            .connect();

        let res = await tc.get('/test');

        let e = document.createElement('span');
        e.innerText = JSON.stringify(res);
        document.getElementById('display').appendChild(e);

        if (res.type === 'dir' && res.entries) {
            document.getElementById('display').appendChild(document.createElement('br'));
            let e = document.createElement('span');
            e.innerText = 'Dir Entries:';
            document.getElementById('display').appendChild(e);
            res.entries.forEach(entry => {
                document.getElementById('display').appendChild(document.createElement('br'));
                e = document.createElement('span');
                e.innerText = `- ${entry}`;
                document.getElementById('display').appendChild(e);
            });
        }
        if (res.type === 'file' && res.content) {
            document.getElementById('display').appendChild(document.createElement('br'));
            let e = document.createElement('span');
            e.innerText = 'Content:';
            document.getElementById('display').appendChild(e);
            document.getElementById('display').appendChild(document.createElement('br'));
            e = document.createElement('span');
            e.innerText = atob(res.content);
            document.getElementById('display').appendChild(e);
        }
    });
</script>

</body>
</html>
